{"version":3,"file":"deepZoom-8yo5wOYM.js","sources":["../../../src/three/plugins/images/sources/DeepZoomImageSource.js","../../../src/three/plugins/images/DeepZoomImagePlugin.js","../../deepZoom.js"],"sourcesContent":["import { TiledImageSource } from './TiledImageSource.js';\n\nexport class DeepZoomImageSource extends TiledImageSource {\n\n\tconstructor( options = {} ) {\n\n\t\tconst { url = null, ...rest } = options;\n\t\tsuper( rest );\n\n\t\tthis.url = url;\n\t\tthis.format = null;\n\t\tthis.stem = null;\n\n\t}\n\n\tgetUrl( x, y, level ) {\n\n\t\treturn `${ this.stem }_files/${ level }/${ x }_${ y }.${ this.format }`;\n\n\t}\n\n\tinit() {\n\n\t\tconst { url } = this;\n\n\t\t// If implementing DeepZoom with limitations like a fixed orthographic camera perspective then\n\t\t// the target tile level can be immediately 'jumped' to for the entire image and in-view tiles\n\t\t// can be immediately queried without any hierarchy traversal. Due the flexibility of camera\n\t\t// type, rotation, and per-tile error calculation we generate a hierarchy.\n\t\treturn this\n\t\t\t.fetchData( url, this.fetchOptions )\n\t\t\t.then( res => res.text() )\n\t\t\t.then( text => {\n\n\t\t\t\tconst xml = new DOMParser().parseFromString( text, 'text/xml' );\n\t\t\t\tif ( xml.querySelector( 'DisplayRects' ) || xml.querySelector( 'Collection' ) ) {\n\n\t\t\t\t\tthrow new Error( 'DeepZoomImagesPlugin: DisplayRect and Collection DZI files not supported.' );\n\n\t\t\t\t}\n\n\t\t\t\t// Elements\n\t\t\t\tconst image = xml.querySelector( 'Image' );\n\t\t\t\tconst size = image.querySelector( 'Size' );\n\n\t\t\t\t// Image properties\n\t\t\t\tconst width = parseInt( size.getAttribute( 'Width' ) );\n\t\t\t\tconst height = parseInt( size.getAttribute( 'Height' ) );\n\t\t\t\tconst tileSize = parseInt( image.getAttribute( 'TileSize' ) );\n\t\t\t\tconst overlap = parseInt( image.getAttribute( 'Overlap' ) );\n\t\t\t\tconst format = image.getAttribute( 'Format' );\n\n\t\t\t\t// Assign deep zoom properties\n\t\t\t\tthis.format = format;\n\t\t\t\tthis.stem = url.split( /\\.[^.]+$/g )[ 0 ];\n\n\t\t\t\t// Assign tiling properties\n\t\t\t\tconst { tiling } = this;\n\t\t\t\tconst levels = Math.ceil( Math.log2( Math.max( width, height ) ) ) + 1;\n\t\t\t\ttiling.flipY = true;\n\t\t\t\ttiling.pixelOverlap = overlap;\n\t\t\t\ttiling.generateLevels( levels, 1, 1, {\n\t\t\t\t\ttilePixelWidth: tileSize,\n\t\t\t\t\ttilePixelHeight: tileSize,\n\t\t\t\t\tpixelWidth: width,\n\t\t\t\t\tpixelHeight: height,\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t}\n\n}\n","import { ImageFormatPlugin } from './ImageFormatPlugin.js';\nimport { DeepZoomImageSource } from './sources/DeepZoomImageSource.js';\n\n// Support for Deep Zoom Image format\n// https://openseadragon.github.io/\n\n// https://learn.microsoft.com/en-us/previous-versions/windows/silverlight/dotnet-windows-silverlight/cc645077(v=vs.95)\nexport class DeepZoomImagePlugin extends ImageFormatPlugin {\n\n\tconstructor( options = {} ) {\n\n\t\tconst { url, ...rest } = options;\n\t\tsuper( rest );\n\n\t\tthis.name = 'DZI_TILES_PLUGIN';\n\t\tthis.imageSource = new DeepZoomImageSource( { url } );\n\n\t}\n\n}\n","import {\n\tScene,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n\tOrthographicCamera,\n} from 'three';\nimport { EnvironmentControls, TilesRenderer, CameraTransitionManager } from '3d-tiles-renderer';\nimport { DeepZoomImagePlugin, UpdateOnChangePlugin } from '3d-tiles-renderer/plugins';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nlet controls, scene, renderer;\nlet tiles, transition;\n\nconst params = {\n\n\terrorTarget: 1,\n\trenderScale: 1,\n\n\torthographic: false,\n\n};\n\ninit();\nrender();\n\nfunction init() {\n\n\t// renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( 0x111111 );\n\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene\n\tscene = new Scene();\n\n\t// set up cameras and ortho / perspective transition\n\ttransition = new CameraTransitionManager(\n\t\tnew PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.001, 10000 ),\n\t\tnew OrthographicCamera( - 1, 1, 1, - 1, 0, 4000 ),\n\t);\n\ttransition.camera.position.set( 0, 0, 150 );\n\ttransition.camera.lookAt( 0, 0, 0 );\n\ttransition.autoSync = false;\n\ttransition.addEventListener( 'camera-change', ( { camera, prevCamera } ) => {\n\n\t\ttiles.deleteCamera( prevCamera );\n\t\ttiles.setCamera( camera );\n\t\tcontrols.setCamera( camera );\n\n\t} );\n\n\t// tiles\n\ttiles = new TilesRenderer( 'https://openseadragon.github.io/example-images/duomo/duomo.dzi' );\n\ttiles.registerPlugin( new DeepZoomImagePlugin( { center: true } ) );\n\ttiles.registerPlugin( new UpdateOnChangePlugin() );\n\ttiles.fetchOptions.mode = 'cors';\n\ttiles.lruCache.minSize = 900;\n\ttiles.lruCache.maxSize = 1300;\n\ttiles.errorTarget = 1;\n\ttiles.setCamera( transition.camera );\n\tscene.add( tiles.group );\n\n\t// controls\n\tcontrols = new EnvironmentControls( scene, transition.camera, renderer.domElement );\n\tcontrols.minZoomDistance = 2;\n\tcontrols.minDistance = 0.01;\n\tcontrols.maxDistance = 1000;\n\tcontrols.cameraRadius = 0;\n\tcontrols.enableDamping = true;\n\tcontrols.fallbackPlane.normal.set( 0, 0, 1 );\n\tcontrols.up.set( 0, 0, 1 );\n\n\t// events\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\n\t// gui initialization\n\tconst gui = new GUI();\n\tgui.add( params, 'orthographic' ).onChange( v => {\n\n\t\ttransition.fixedPoint.copy( controls.pivotPoint );\n\n\t\t// adjust the camera before the transition begins\n\t\ttransition.syncCameras();\n\t\tcontrols.adjustCamera( transition.perspectiveCamera );\n\t\tcontrols.adjustCamera( transition.orthographicCamera );\n\t\ttransition.toggle();\n\n\t} );\n\n\tgui.add( params, 'errorTarget', 0, 100 ).onChange( () => {\n\n\t\ttiles.getPluginByName( 'UPDATE_ON_CHANGE_PLUGIN' ).needsUpdate = true;\n\n\t} );\n\tgui.add( params, 'renderScale', 0.1, 1.0, 0.05 ).onChange( v => renderer.setPixelRatio( v * window.devicePixelRatio ) );\n\n\tgui.open();\n\n}\n\nfunction onWindowResize() {\n\n\tconst { perspectiveCamera, orthographicCamera } = transition;\n\tconst aspect = window.innerWidth / window.innerHeight;\n\n\torthographicCamera.bottom = - 40;\n\torthographicCamera.top = 40;\n\torthographicCamera.left = - 40 * aspect;\n\torthographicCamera.right = 40 * aspect;\n\torthographicCamera.updateProjectionMatrix();\n\n\tperspectiveCamera.aspect = aspect;\n\tperspectiveCamera.updateProjectionMatrix();\n\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n}\n\nfunction render() {\n\n\trequestAnimationFrame( render );\n\n\tcontrols.enabled = ! transition.animating;\n\tcontrols.update();\n\ttransition.update();\n\n\tconst camera = transition.camera;\n\tcamera.updateMatrixWorld();\n\n\ttiles.errorTarget = params.errorTarget;\n\ttiles.setCamera( camera );\n\ttiles.setResolutionFromRenderer( camera, renderer );\n\ttiles.update();\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["DeepZoomImageSource","TiledImageSource","options","url","rest","x","y","level","res","text","xml","image","size","width","height","tileSize","overlap","format","tiling","levels","DeepZoomImagePlugin","ImageFormatPlugin","controls","scene","renderer","tiles","transition","params","init","render","WebGLRenderer","Scene","CameraTransitionManager","PerspectiveCamera","OrthographicCamera","camera","prevCamera","TilesRenderer","UpdateOnChangePlugin","EnvironmentControls","onWindowResize","gui","GUI","v","perspectiveCamera","orthographicCamera","aspect"],"mappings":"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"}