import{M as T,W as B,S as O,a as j}from"./three.module-CQU0seT4.js";/* empty css               */import{g as k}from"./lil-gui.module.min-Vka56b52.js";import{a as V}from"./I3DMLoader--guqwtSo.js";import{L as _}from"./readMagicBytes-ReGFEf36.js";import{P as z}from"./TMSImageSource-BwMpBOyS.js";import{W as $}from"./EPSGTilesPlugin-DJF9gzHX.js";import{T as N}from"./TilesRenderer-Dt06WWnf.js";import{T as Q}from"./TilesFadePlugin-D_u_P2Qt.js";import{U as J}from"./UpdateOnChangePlugin-Dcw2gdwr.js";import{E as K}from"./EnvironmentControls-CLbQ_1-I.js";import{G as X}from"./GlobeControls-CKSk7BfI.js";import"./GLTFLoader-Bzr6GmPM.js";import"./Ellipsoid-BKsGN9dG.js";import"./TiledImageSource-Dter0Emb.js";import"./ImageFormatPlugin-gd2xpo9t.js";import"./B3DMLoader-BZtrZCNg.js";import"./PNTSLoader-gB5YPyhc.js";import"./CMPTLoader-VEto4VOC.js";import"./EllipsoidRegion-BEIhCuST.js";const b=V*Math.PI*2,v=new z("EPSG:3857");function G(e){return/(:84|:crs84)$/i.test(e)}function Y(e){return/:4326$/i.test(e)}function M(e){return/:3857$/i.test(e)}function D(e){return e.trim().split(/\s+/).map(t=>parseFloat(t))}function E(e,t){Y(t)&&([e[1],e[0]]=[e[0],e[1]])}function q(e,t){if(M(t))return e[0]=v.convertProjectionToLongitude(.5+e[0]/b),e[1]=v.convertProjectionToLatitude(.5+e[1]/b),e[0]*=T.RAD2DEG,e[1]*=T.RAD2DEG,e}function L(e){e[0]*=T.DEG2RAD,e[1]*=T.DEG2RAD}class Z extends _{parse(t){const n=new TextDecoder("utf-8").decode(new Uint8Array(t)),r=new DOMParser().parseFromString(n,"text/xml"),s=r.querySelector("Contents"),c=x(s,"TileMatrixSet").map(d=>oe(d)),l=x(s,"Layer").map(d=>te(d)),f=ee(r.querySelector("ServiceIdentification"));return l.forEach(d=>{d.tileMatrixSets=d.tileMatrixSetLinks.map(S=>c.find(i=>i.identifier===S))}),{serviceIdentification:f,tileMatrixSets:c,layers:l}}}function ee(e){var c;const t=e.querySelector("Title").textContent,n=((c=e.querySelector("Abstract"))==null?void 0:c.textContent)||"",r=e.querySelector("ServiceType").textContent,s=e.querySelector("ServiceTypeVersion").textContent;return{title:t,abstract:n,serviceType:r,serviceTypeVersion:s}}function te(e){const t=e.querySelector("Title").textContent,n=e.querySelector("Identifier").textContent,r=e.querySelector("Format").textContent,s=x(e,"ResourceURL").map(S=>ne(S)),c=x(e,"TileMatrixSetLink").map(S=>x(S,"TileMatrixSet")[0].textContent),l=x(e,"Style").map(S=>ie(S)),f=x(e,"Dimension").map(S=>re(S));let d=I(e.querySelector("WGS84BoundingBox"));return d||(d=I(e.querySelector("BoundingBox"))),{title:t,identifier:n,format:r,dimensions:f,tileMatrixSetLinks:c,styles:l,boundingBox:d,resourceUrls:s}}function ne(e){const t=e.getAttribute("template"),n=e.getAttribute("format"),r=e.getAttribute("resourceType");return{template:t,format:n,resourceType:r}}function re(e){var l,f;const t=e.querySelector("Identifier").textContent,n=((l=e.querySelector("UOM"))==null?void 0:l.textContent)||"",r=e.querySelector("Default").textContent,s=((f=e.querySelector("Current"))==null?void 0:f.textContent)==="true",c=x(e,"Value").map(d=>d.textContent);return{identifier:t,uom:n,defaultValue:r,current:s,values:c}}function I(e){if(!e)return null;let t=e.getAttribute("crs");const n=D(e.querySelector("LowerCorner").textContent),r=D(e.querySelector("UpperCorner").textContent);return E(n,t),E(r,t),q(n,t),q(r,t),L(n),L(r),G(t)?t="EPSG:4326":M(t)&&(t="EPSG:3857"),{crs:t,lowerCorner:n,upperCorner:r,bounds:[...n,...r]}}function ie(e){const t=e.querySelector("Title").textContent,n=e.querySelector("Identifier").textContent,r=e.getAttribute("isDefault")==="true";return{title:t,identifier:n,isDefault:r}}function oe(e){var l,f;let t=e.querySelector("SupportedCRS").textContent;const n=((l=e.querySelector("Title"))==null?void 0:l.textContent)||"",r=e.querySelector("Identifier").textContent,s=((f=e.querySelector("Abstract"))==null?void 0:f.textContent)||"",c=[];return e.querySelectorAll("TileMatrix").forEach((d,S)=>{const i=ae(d),P=28e-5*i.scaleDenominator,R=i.tileWidth*i.matrixWidth*P,W=i.tileHeight*i.matrixHeight*P;let h;E(i.topLeftCorner,t),M(t)?h=[i.topLeftCorner[0]+R,i.topLeftCorner[1]-W]:h=[i.topLeftCorner[0]+360*R/b,i.topLeftCorner[1]-360*W/b],q(h,t),q(i.topLeftCorner,t),L(h),L(i.topLeftCorner),i.bounds=[...i.topLeftCorner,...h],[i.bounds[1],i.bounds[3]]=[i.bounds[3],i.bounds[1]],c.push(i)}),G(t)?t="EPSG:4326":M(t)&&(t="EPSG:3857"),{title:n,identifier:r,abstract:s,supportedCRS:t,tileMatrices:c}}function ae(e){const t=e.querySelector("Identifier").textContent,n=parseFloat(e.querySelector("TileWidth").textContent),r=parseFloat(e.querySelector("TileHeight").textContent),s=parseFloat(e.querySelector("MatrixWidth").textContent),c=parseFloat(e.querySelector("MatrixHeight").textContent),l=parseFloat(e.querySelector("ScaleDenominator").textContent),f=D(e.querySelector("TopLeftCorner").textContent);return{identifier:t,tileWidth:n,tileHeight:r,matrixWidth:s,matrixHeight:c,scaleDenominator:l,topLeftCorner:f,bounds:null}}function x(e,t){return[...e.children].filter(n=>n.tagName===t)}const U=window.location.hash.replace(/^#/,"")||"https://gibs.earthdata.nasa.gov/wmts/epsg4326/best/wmts.cgi?SERVICE=WMTS&request=GetCapabilities";let o,w,m,u,p,C,a,y;se();F();function se(){m=new B({antialias:!0}),m.setPixelRatio(window.devicePixelRatio),m.setSize(window.innerWidth,window.innerHeight),m.setClearColor(1118481),m.setAnimationLoop(F),document.body.appendChild(m.domElement),w=new O,p=new j(60,window.innerWidth/window.innerHeight,.001,1e4),ce(),A(),window.addEventListener("resize",A,!1),window.addEventListener("hashchange",()=>location.reload())}async function ce(){y=await new Z().loadAsync(U);let e="MODIS_Terra_CorrectedReflectance_TrueColor";y.layers.find(t=>t.identifier===e)||(e=y.layers[0].identifier),a={layer:e,style:null,tileMatrixSet:null,planar:!1,dimensions:{}},H(),g()}function H(){C&&C.destroy(),a.style=null,a.tileMatrixSet=null,a.dimensions={};const e=y.layers.find(n=>n.identifier===a.layer);a.style=e.styles.find(n=>n.isDefault).identifier,a.tileMatrixSet=e.tileMatrixSets[0].identifier;const t=y.serviceIdentification.abstract;document.getElementById("info").innerHTML="<b>"+y.serviceIdentification.title+"</b>"+(t?"<br/>"+t:"")+"<br/>"+e.title,C=new k,C.add(a,"planar").onChange(g),C.add(a,"layer",y.layers.map(n=>n.identifier)).onChange(()=>{H(),g()}),C.add(a,"tileMatrixSet",e.tileMatrixSets.map(n=>n.identifier)).onChange(g),C.add(a,"style",e.styles.map(n=>n.identifier)).onChange(g);for(const n in e.dimensions){const r=e.dimensions[n];a.dimensions[r.identifier]=e.dimensions[n].defaultValue;let s=r.values;r.identifier==="Time"&&/gibs.earthdata/.test(U)&&(s=s.flatMap(c=>{const l=c.split(/\//g);return l.pop(),l}),/^MODIS_Terra/.test(a.layer)&&(s.push("2013-06-16"),a.dimensions[r.identifier]="2013-06-16")),C.add(a.dimensions,r.identifier,s).onChange(g)}}function g(){u&&u.dispose(),o&&(o.dispose(),o=null),u=new N,u.registerPlugin(new Q),u.registerPlugin(new J),u.registerPlugin(new $({shape:a.planar?"planar":"ellipsoid",center:!0,capabilities:y,...a})),u.setCamera(p),w.add(u.group),a.planar?(o=new K(w,p,m.domElement),o.enableDamping=!0,o.minDistance=1e-4,o.maxDistance=5,o.cameraRadius=0,o.fallbackPlane.normal.set(0,0,1),o.up.set(0,0,1),o.camera.position.set(0,0,2),o.camera.quaternion.identity(),p.near=1e-4,p.far=10,p.updateProjectionMatrix()):(u.group.rotation.x=-Math.PI/2,o=new X(w,p,m.domElement),o.setEllipsoid(u.ellipsoid,u.group),o.enableDamping=!0,o.camera.position.set(0,0,1.75*1e7),o.camera.quaternion.identity(),o.minDistance=150)}function A(){const e=window.innerWidth/window.innerHeight;p.aspect=e,p.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight)}function F(){o&&(o.update(),p.updateMatrixWorld()),u&&(u.setCamera(p),u.setResolutionFromRenderer(p,m),u.update()),m.render(w,p)}
//# sourceMappingURL=wmtsTiles-4LPyk6fv.js.map
