{"version":3,"file":"wmtsTiles-4LPyk6fv.js","sources":["../../../src/three/plugins/loaders/WMTSCapabilitiesLoader.js","../../wmtsTiles.js"],"sourcesContent":["import { WGS84_RADIUS } from '../../../core/renderer/constants.js';\nimport { LoaderBase } from '../../../core/renderer/loaders/LoaderBase.js';\nimport { ProjectionScheme } from '../images/utils/ProjectionScheme.js';\nimport { MathUtils } from 'three';\n\nconst EQUATOR_CIRCUMFERENCE = WGS84_RADIUS * Math.PI * 2;\nconst mercatorProjection = /* @__PURE__ */ new ProjectionScheme( 'EPSG:3857' );\n\n// this CRS84 crs is the same as EPSG:4326 except the order of lat / lon are swapped\nfunction isCRS84( crs ) {\n\n\treturn /(:84|:crs84)$/i.test( crs );\n\n}\n\nfunction isEPSG4326( crs ) {\n\n\treturn /:4326$/i.test( crs );\n\n}\n\nfunction isWebMercator( crs ) {\n\n\treturn /:3857$/i.test( crs );\n\n}\n\n// parse a series of space-separated numbers\nfunction parseTuple( tuple ) {\n\n\treturn tuple.trim().split( /\\s+/ ).map( v => parseFloat( v ) );\n\n}\n\n// swap the tuple order to lon, lat if crs is EPSG:4326 since the tiles renderer project\n// expects lon, lat order\nfunction correctTupleOrder( tuple, crs ) {\n\n\tif ( isEPSG4326( crs ) ) {\n\n\t\t[ tuple[ 1 ], tuple[ 0 ] ] = [ tuple[ 0 ], tuple[ 1 ] ];\n\n\t}\n\n}\n\n// web mercator specifies bounding boxes etc as meters assuming the width and height of the full image span\n// is aligned to the globe equator circumference.\nfunction correctTupleUnits( tuple, crs ) {\n\n\tif ( isWebMercator( crs ) ) {\n\n\t\ttuple[ 0 ] = mercatorProjection.convertProjectionToLongitude( 0.5 + tuple[ 0 ] / EQUATOR_CIRCUMFERENCE );\n\t\ttuple[ 1 ] = mercatorProjection.convertProjectionToLatitude( 0.5 + tuple[ 1 ] / EQUATOR_CIRCUMFERENCE );\n\n\t\t// to degrees\n\t\ttuple[ 0 ] *= MathUtils.RAD2DEG;\n\t\ttuple[ 1 ] *= MathUtils.RAD2DEG;\n\n\t\treturn tuple;\n\n\t}\n\n}\n\nfunction tupleToRadians( tuple ) {\n\n\ttuple[ 0 ] *= MathUtils.DEG2RAD;\n\ttuple[ 1 ] *= MathUtils.DEG2RAD;\n\n}\n\nexport class WMTSCapabilitiesLoader extends LoaderBase {\n\n\tparse( buffer ) {\n\n\t\tconst str = new TextDecoder( 'utf-8' ).decode( new Uint8Array( buffer ) );\n\t\tconst xml = new DOMParser().parseFromString( str, 'text/xml' );\n\t\tconst contents = xml.querySelector( 'Contents' );\n\n\t\tconst tileMatrixSets = getChildrenByTag( contents, 'TileMatrixSet' ).map( el => parseTileMatrixSet( el ) );\n\t\tconst layers = getChildrenByTag( contents, 'Layer' ).map( el => parseLayer( el ) );\n\t\tconst serviceIdentification = parseServiceIdentification( xml.querySelector( 'ServiceIdentification' ) );\n\n\t\tlayers.forEach( layer => {\n\n\t\t\tlayer.tileMatrixSets = layer.tileMatrixSetLinks.map( key => {\n\n\t\t\t\treturn tileMatrixSets.find( tms => tms.identifier === key );\n\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn {\n\t\t\tserviceIdentification,\n\t\t\ttileMatrixSets,\n\t\t\tlayers,\n\t\t};\n\n\t}\n\n}\n\n// parse <ows:ServiceIdentification> tag\nfunction parseServiceIdentification( el ) {\n\n\tconst title = el.querySelector( 'Title' ).textContent;\n\tconst abstract = el.querySelector( 'Abstract' )?.textContent || '';\n\tconst serviceType = el.querySelector( 'ServiceType' ).textContent;\n\tconst serviceTypeVersion = el.querySelector( 'ServiceTypeVersion' ).textContent;\n\n\treturn {\n\t\ttitle,\n\t\tabstract,\n\t\tserviceType,\n\t\tserviceTypeVersion,\n\t};\n\n}\n\n// parse <Layers> tag\nfunction parseLayer( el ) {\n\n\tconst title = el.querySelector( 'Title' ).textContent;\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst format = el.querySelector( 'Format' ).textContent;\n\tconst resourceUrls = getChildrenByTag( el, 'ResourceURL' ).map( el => {\n\n\t\treturn parseResourceUrl( el );\n\n\t} );\n\tconst tileMatrixSetLinks = getChildrenByTag( el, 'TileMatrixSetLink' ).map( el => {\n\n\t\treturn getChildrenByTag( el, 'TileMatrixSet' )[ 0 ].textContent;\n\n\t} );\n\tconst styles = getChildrenByTag( el, 'Style' ).map( el => {\n\n\t\treturn parseStyle( el );\n\n\t} );\n\tconst dimensions = getChildrenByTag( el, 'Dimension' ).map( el => {\n\n\t\treturn parseDimension( el );\n\n\t} );\n\n\tlet boundingBox = parseBoundingBox( el.querySelector( 'WGS84BoundingBox' ) );\n\tif ( ! boundingBox ) {\n\n\t\tboundingBox = parseBoundingBox( el.querySelector( 'BoundingBox' ) );\n\n\t}\n\n\treturn {\n\t\ttitle,\n\t\tidentifier,\n\t\tformat,\n\t\tdimensions,\n\t\ttileMatrixSetLinks,\n\t\tstyles,\n\t\tboundingBox,\n\t\tresourceUrls,\n\t};\n\n}\n\n// parse layer <ResourceURL> tag\nfunction parseResourceUrl( el ) {\n\n\tconst template = el.getAttribute( 'template' );\n\tconst format = el.getAttribute( 'format' );\n\tconst resourceType = el.getAttribute( 'resourceType' );\n\n\treturn {\n\t\ttemplate,\n\t\tformat,\n\t\tresourceType,\n\t};\n\n}\n\n// parse layer <Dimension> tag\nfunction parseDimension( el ) {\n\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst uom = el.querySelector( 'UOM' )?.textContent || '';\n\tconst defaultValue = el.querySelector( 'Default' ).textContent;\n\tconst current = el.querySelector( 'Current' )?.textContent === 'true';\n\tconst values = getChildrenByTag( el, 'Value' ).map( el => el.textContent );\n\treturn {\n\t\tidentifier,\n\t\tuom,\n\t\tdefaultValue,\n\t\tcurrent,\n\t\tvalues,\n\t};\n\n}\n\n// parse <ows:WGS84BoundingBox> and <BoundingBox> tags\nfunction parseBoundingBox( el ) {\n\n\tif ( ! el ) {\n\n\t\treturn null;\n\n\t}\n\n\tlet crs = el.getAttribute( 'crs' );\n\tconst lowerCorner = parseTuple( el.querySelector( 'LowerCorner' ).textContent );\n\tconst upperCorner = parseTuple( el.querySelector( 'UpperCorner' ).textContent );\n\n\tcorrectTupleOrder( lowerCorner, crs );\n\tcorrectTupleOrder( upperCorner, crs );\n\n\tcorrectTupleUnits( lowerCorner, crs );\n\tcorrectTupleUnits( upperCorner, crs );\n\n\ttupleToRadians( lowerCorner );\n\ttupleToRadians( upperCorner );\n\n\tif ( isCRS84( crs ) ) {\n\n\t\tcrs = 'EPSG:4326';\n\n\t} else if ( isWebMercator( crs ) ) {\n\n\t\tcrs = 'EPSG:3857';\n\n\t}\n\n\treturn {\n\t\tcrs,\n\t\tlowerCorner,\n\t\tupperCorner,\n\t\tbounds: [ ...lowerCorner, ...upperCorner ],\n\t};\n\n}\n\n// parse layer <Style> tag\nfunction parseStyle( el ) {\n\n\tconst title = el.querySelector( 'Title' ).textContent;\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst isDefault = el.getAttribute( 'isDefault' ) === 'true';\n\n\treturn {\n\t\ttitle,\n\t\tidentifier,\n\t\tisDefault,\n\t};\n\n}\n\n// parse <TileMatrixSet> tag\nfunction parseTileMatrixSet( el ) {\n\n\tlet supportedCRS = el.querySelector( 'SupportedCRS' ).textContent;\n\tconst title = el.querySelector( 'Title' )?.textContent || '';\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst abstract = el.querySelector( 'Abstract' )?.textContent || '';\n\tconst tileMatrices = [];\n\tel\n\t\t.querySelectorAll( 'TileMatrix' )\n\t\t.forEach( ( el, i ) => {\n\n\t\t\tconst tm = parseTileMatrix( el );\n\n\t\t\tconst pixelSpan = 0.00028 * tm.scaleDenominator;\n\t\t\tconst groundWidth = tm.tileWidth * tm.matrixWidth * pixelSpan;\n\t\t\tconst groundHeight = tm.tileHeight * tm.matrixHeight * pixelSpan;\n\t\t\tlet bottomRightCorner;\n\n\t\t\tcorrectTupleOrder( tm.topLeftCorner, supportedCRS );\n\n\t\t\tif ( isWebMercator( supportedCRS ) ) {\n\n\t\t\t\tbottomRightCorner = [\n\t\t\t\t\ttm.topLeftCorner[ 0 ] + groundWidth,\n\t\t\t\t\ttm.topLeftCorner[ 1 ] - groundHeight,\n\t\t\t\t];\n\n\t\t\t} else {\n\n\t\t\t\tbottomRightCorner = [\n\t\t\t\t\ttm.topLeftCorner[ 0 ] + 360 * groundWidth / EQUATOR_CIRCUMFERENCE,\n\t\t\t\t\ttm.topLeftCorner[ 1 ] - 360 * groundHeight / EQUATOR_CIRCUMFERENCE,\n\t\t\t\t];\n\n\t\t\t}\n\n\t\t\tcorrectTupleUnits( bottomRightCorner, supportedCRS );\n\t\t\tcorrectTupleUnits( tm.topLeftCorner, supportedCRS );\n\n\t\t\ttupleToRadians( bottomRightCorner );\n\t\t\ttupleToRadians( tm.topLeftCorner );\n\n\t\t\t// construct the bounds\n\t\t\ttm.bounds = [ ...tm.topLeftCorner, ...bottomRightCorner ];\n\n\t\t\t// ensure min and max order is correct\n\t\t\t[ tm.bounds[ 1 ], tm.bounds[ 3 ] ] = [ tm.bounds[ 3 ], tm.bounds[ 1 ] ];\n\n\t\t\ttileMatrices.push( tm );\n\n\t\t} );\n\n\tif ( isCRS84( supportedCRS ) ) {\n\n\t\tsupportedCRS = 'EPSG:4326';\n\n\t} else if ( isWebMercator( supportedCRS ) ) {\n\n\t\tsupportedCRS = 'EPSG:3857';\n\n\t}\n\n\treturn {\n\t\ttitle,\n\t\tidentifier,\n\t\tabstract,\n\t\tsupportedCRS,\n\t\ttileMatrices,\n\t};\n\n}\n\n// parse tile matrix set <TileMatrix> tag\nfunction parseTileMatrix( el ) {\n\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst tileWidth = parseFloat( el.querySelector( 'TileWidth' ).textContent );\n\tconst tileHeight = parseFloat( el.querySelector( 'TileHeight' ).textContent );\n\tconst matrixWidth = parseFloat( el.querySelector( 'MatrixWidth' ).textContent );\n\tconst matrixHeight = parseFloat( el.querySelector( 'MatrixHeight' ).textContent );\n\tconst scaleDenominator = parseFloat( el.querySelector( 'ScaleDenominator' ).textContent );\n\tconst topLeftCorner = parseTuple( el.querySelector( 'TopLeftCorner' ).textContent );\n\n\treturn {\n\t\tidentifier,\n\t\ttileWidth,\n\t\ttileHeight,\n\t\tmatrixWidth,\n\t\tmatrixHeight,\n\t\tscaleDenominator,\n\t\ttopLeftCorner,\n\t\tbounds: null,\n\t};\n\n}\n\n// utility for finding immediate children by tag name\nfunction getChildrenByTag( el, tag ) {\n\n\treturn [ ...el.children ].filter( c => c.tagName === tag );\n\n}\n","import {\n\tScene,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n} from 'three';\nimport { TilesRenderer, GlobeControls, EnvironmentControls } from '3d-tiles-renderer';\nimport { TilesFadePlugin, UpdateOnChangePlugin, WMTSCapabilitiesLoader, WMTSTilesPlugin } from '3d-tiles-renderer/plugins';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nconst url = window.location.hash.replace( /^#/, '' ) || 'https://gibs.earthdata.nasa.gov/wmts/epsg4326/best/wmts.cgi?SERVICE=WMTS&request=GetCapabilities';\n\nlet controls, scene, renderer;\nlet tiles, camera, gui;\nlet params, capabilities;\n\ninit();\nrender();\n\nfunction init() {\n\n\t// renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( 0x111111 );\n\trenderer.setAnimationLoop( render );\n\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene\n\tscene = new Scene();\n\n\t// set up cameras and ortho / perspective transition\n\tcamera = new PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.001, 10000 );\n\n\t// update the capabilities file\n\tupdateCapabilities();\n\n\t// events\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\twindow.addEventListener( 'hashchange', () => location.reload() );\n\n}\n\nasync function updateCapabilities() {\n\n\t// load the capabilities file\n\tcapabilities = await new WMTSCapabilitiesLoader().loadAsync( url );\n\n\t// use a default overlay\n\tlet defaultLayer = 'MODIS_Terra_CorrectedReflectance_TrueColor';\n\tif ( ! capabilities.layers.find( l => l.identifier === defaultLayer ) ) {\n\n\t\tdefaultLayer = capabilities.layers[ 0 ].identifier;\n\n\t}\n\n\t// set up the parameters\n\tparams = {\n\t\tlayer: defaultLayer,\n\t\tstyle: null,\n\t\ttileMatrixSet: null,\n\t\tplanar: false,\n\t\tdimensions: {},\n\t};\n\n\trebuildGUI();\n\trebuildTiles();\n\n}\n\nfunction rebuildGUI() {\n\n\tif ( gui ) {\n\n\t\tgui.destroy();\n\n\t}\n\n\tparams.style = null;\n\tparams.tileMatrixSet = null;\n\tparams.dimensions = {};\n\n\t// initialize the layer settings\n\tconst layer = capabilities.layers.find( l => l.identifier === params.layer );\n\tparams.style = layer.styles.find( s => s.isDefault ).identifier;\n\tparams.tileMatrixSet = layer.tileMatrixSets[ 0 ].identifier;\n\n\t// update the ui\n\tconst abstract = capabilities.serviceIdentification.abstract;\n\tdocument.getElementById( 'info' ).innerHTML =\n\t\t'<b>' + capabilities.serviceIdentification.title + '</b>' + ( abstract ? '<br/>' + abstract : '' ) +\n\t\t'<br/>' + layer.title;\n\n\n\tgui = new GUI();\n\tgui.add( params, 'planar' ).onChange( rebuildTiles );\n\tgui.add( params, 'layer', capabilities.layers.map( l => l.identifier ) ).onChange( () => {\n\n\t\trebuildGUI( url );\n\t\trebuildTiles();\n\n\t} );\n\tgui.add( params, 'tileMatrixSet', layer.tileMatrixSets.map( tms => tms.identifier ) ).onChange( rebuildTiles );\n\tgui.add( params, 'style', layer.styles.map( s => s.identifier ) ).onChange( rebuildTiles );\n\n\t// create the UI for dimensions\n\tfor ( const key in layer.dimensions ) {\n\n\t\tconst dim = layer.dimensions[ key ];\n\t\tparams.dimensions[ dim.identifier ] = layer.dimensions[ key ].defaultValue;\n\n\t\t// Note that NASA GIBS uses a custom notation for time\n\t\t// https://www.earthdata.nasa.gov/news/blog/wmts-time-dimensions-restful-access\n\t\tlet values = dim.values;\n\t\tif ( dim.identifier === 'Time' && /gibs.earthdata/.test( url ) ) {\n\n\t\t\tvalues = values.flatMap( v => {\n\n\t\t\t\tconst tokens = v.split( /\\//g );\n\t\t\t\ttokens.pop();\n\t\t\t\treturn tokens;\n\n\t\t\t} );\n\n\t\t\tif ( /^MODIS_Terra/.test( params.layer ) ) {\n\n\t\t\t\t// NOTE: this is a good full-ranged time to use with a full set of data typically used by GIBs for demos\n\t\t\t\tvalues.push( '2013-06-16' );\n\t\t\t\tparams.dimensions[ dim.identifier ] = '2013-06-16';\n\n\t\t\t}\n\n\t\t}\n\n\t\tgui.add( params.dimensions, dim.identifier, values ).onChange( rebuildTiles );\n\n\t}\n\n}\n\nfunction rebuildTiles() {\n\n\tif ( tiles ) {\n\n\t\ttiles.dispose();\n\n\t}\n\n\tif ( controls ) {\n\n\t\tcontrols.dispose();\n\t\tcontrols = null;\n\n\t}\n\n\t// tiles\n\ttiles = new TilesRenderer();\n\ttiles.registerPlugin( new TilesFadePlugin() );\n\ttiles.registerPlugin( new UpdateOnChangePlugin() );\n\ttiles.registerPlugin( new WMTSTilesPlugin( {\n\t\tshape: params.planar ? 'planar' : 'ellipsoid',\n\t\tcenter: true,\n\t\tcapabilities,\n\t\t...params,\n\t} ) );\n\n\ttiles.setCamera( camera );\n\tscene.add( tiles.group );\n\n\tif ( params.planar ) {\n\n\t\t// create the controls\n\t\tcontrols = new EnvironmentControls( scene, camera, renderer.domElement );\n\t\tcontrols.enableDamping = true;\n\t\tcontrols.minDistance = 1e-4;\n\t\tcontrols.maxDistance = 5;\n\t\tcontrols.cameraRadius = 0;\n\t\tcontrols.fallbackPlane.normal.set( 0, 0, 1 );\n\t\tcontrols.up.set( 0, 0, 1 );\n\t\tcontrols.camera.position.set( 0, 0, 2 );\n\t\tcontrols.camera.quaternion.identity();\n\n\t\t// reset the camera\n\t\tcamera.near = 1e-4;\n\t\tcamera.far = 10;\n\t\tcamera.updateProjectionMatrix();\n\n\t} else {\n\n\t\t// init tiles\n\t\ttiles.group.rotation.x = - Math.PI / 2;\n\n\t\t// create the controls\n\t\tcontrols = new GlobeControls( scene, camera, renderer.domElement );\n\t\tcontrols.setEllipsoid( tiles.ellipsoid, tiles.group );\n\t\tcontrols.enableDamping = true;\n\t\tcontrols.camera.position.set( 0, 0, 1.75 * 1e7 );\n\t\tcontrols.camera.quaternion.identity();\n\t\tcontrols.minDistance = 150;\n\n\t}\n\n}\n\nfunction onWindowResize() {\n\n\tconst aspect = window.innerWidth / window.innerHeight;\n\tcamera.aspect = aspect;\n\tcamera.updateProjectionMatrix();\n\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n}\n\nfunction render() {\n\n\tif ( controls ) {\n\n\t\tcontrols.update();\n\t\tcamera.updateMatrixWorld();\n\n\t}\n\n\tif ( tiles ) {\n\n\t\ttiles.setCamera( camera );\n\t\ttiles.setResolutionFromRenderer( camera, renderer );\n\t\ttiles.update();\n\n\t}\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["EQUATOR_CIRCUMFERENCE","WGS84_RADIUS","mercatorProjection","ProjectionScheme","isCRS84","crs","isEPSG4326","isWebMercator","parseTuple","tuple","v","correctTupleOrder","correctTupleUnits","MathUtils","tupleToRadians","WMTSCapabilitiesLoader","LoaderBase","buffer","str","xml","contents","tileMatrixSets","getChildrenByTag","el","parseTileMatrixSet","layers","parseLayer","serviceIdentification","parseServiceIdentification","layer","key","tms","title","abstract","_a","serviceType","serviceTypeVersion","identifier","format","resourceUrls","parseResourceUrl","tileMatrixSetLinks","styles","parseStyle","dimensions","parseDimension","boundingBox","parseBoundingBox","template","resourceType","uom","defaultValue","current","_b","values","lowerCorner","upperCorner","isDefault","supportedCRS","tileMatrices","i","tm","parseTileMatrix","pixelSpan","groundWidth","groundHeight","bottomRightCorner","tileWidth","tileHeight","matrixWidth","matrixHeight","scaleDenominator","topLeftCorner","tag","c","url","controls","scene","renderer","tiles","camera","gui","params","capabilities","init","render","WebGLRenderer","Scene","PerspectiveCamera","updateCapabilities","onWindowResize","defaultLayer","l","rebuildGUI","rebuildTiles","s","GUI","dim","tokens","TilesRenderer","TilesFadePlugin","UpdateOnChangePlugin","WMTSTilesPlugin","EnvironmentControls","GlobeControls","aspect"],"mappings":"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"}