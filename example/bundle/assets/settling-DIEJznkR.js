import{aH as D,k as P,l as g,b7 as W,V as z,R as B,ae as V,M as J}from"./three.module-CQU0seT4.js";import{r as c,u as E,d as S,i as N,a as k,k as H,j as a,c as $,C as K,T as X,b as j,G as Y}from"./CameraControls-BTa4S6yL.js";import{D as Z}from"./DRACOLoader-BRrjJKJj.js";import{u as ee,T as te}from"./leva.esm-C6sHvZt1.js";import{C as se,T as re}from"./TilesLoadingBar-DWCtesE7.js";import{C as ne}from"./CameraViewTransition-CQmHl6JH.js";import{E as ie,O as G}from"./Ellipsoid-BKsGN9dG.js";import{E as oe}from"./Environment-CaTRor8q.js";import{C as ae}from"./CesiumIonAuthPlugin-DL6JcDIR.js";import{G as le}from"./GLTFExtensionsPlugin-DKG5_O3O.js";import{T as ue}from"./TileCompressionPlugin-D2vhaUyU.js";import{U as ce}from"./UpdateOnChangePlugin-Dcw2gdwr.js";import{T as de}from"./TilesFadePlugin-D_u_P2Qt.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./EnvironmentControls-CLbQ_1-I.js";import"./GlobeControls-CKSk7BfI.js";import"./I3DMLoader--guqwtSo.js";import"./readMagicBytes-ReGFEf36.js";import"./GLTFLoader-Bzr6GmPM.js";import"./TilesRenderer-Dt06WWnf.js";import"./B3DMLoader-BZtrZCNg.js";import"./PNTSLoader-gB5YPyhc.js";import"./CMPTLoader-VEto4VOC.js";import"./EllipsoidRegion-BEIhCuST.js";import"./CanvasDOMOverlay-DhqylH3l.js";import"./extends-CF3RwP-h.js";import"./CameraTransitionManager-BIWFAn1E.js";import"./constants-BeIdOgZ8.js";import"./GeometryClipper-DDKqlNfA.js";import"./EPSGTilesPlugin-DJF9gzHX.js";import"./ImageFormatPlugin-gd2xpo9t.js";import"./TMSImageSource-BwMpBOyS.js";import"./TiledImageSource-Dter0Emb.js";function U(...h){return c.useCallback(e=>{h.forEach(t=>{t&&(typeof t=="function"?t(e):t.current=e)})},h)}function F(h,e){e(h)||h.children.forEach(t=>{F(t,e)})}class pe extends D{constructor(){super(),this.objects=new Set,this.observed=new Set,this._addedCallback=({child:e})=>{F(e,t=>this.observed.has(t)?!0:(this.objects.add(t),t.addEventListener("childadded",this._addedCallback),t.addEventListener("childremoved",this._removedCallback),this.dispatchEvent({type:"childadded",child:e}),!1))},this._removedCallback=({child:e})=>{F(e,t=>this.observed.has(t)?!0:(this.objects.delete(t),t.removeEventListener("childadded",this._addedCallback),t.removeEventListener("childremoved",this._removedCallback),this.dispatchEvent({type:"childremoved",child:e}),!1))}}observe(e){const{observed:t}=this;this._addedCallback({child:e}),t.add(e)}unobserve(e){const{observed:t}=this;t.delete(e),this._removedCallback({child:e})}dispose(){this.observed.forEach(e=>{this.unobserve(e)})}}const R=new B,q=new W,C=new W,O=new z,w=new g,A=new P;class me extends D{constructor(){super(),this.autoRun=!0,this.queryMap=new Map,this.index=0,this.queued=[],this.scheduled=!1,this.duration=1,this.objects=[],this.observer=new pe,this.ellipsoid=new ie,this.frame=new P,this.cameras=new Set;const e=(()=>{let t=!1;return()=>{t||(t=!0,queueMicrotask(()=>{this.queryMap.forEach(n=>this._enqueue(n)),t=!1}))}})();this.observer.addEventListener("childadded",e),this.observer.addEventListener("childremoved",e)}_enqueue(e){e.queued||(this.queued.push(e),e.queued=!0,this._scheduleRun())}_runJobs(){const{queued:e,cameras:t,duration:n}=this,s=performance.now();for(t.forEach((r,l)=>{A.copy(r.matrixWorldInverse).premultiply(r.projectionMatrix),w.set(0,0,-1).transformDirection(r.matrixWorld),q.start.setFromMatrixPosition(r.matrixWorld),q.end.addVectors(w,q.start);for(let d=0,i=e.length;d<i;d++){const o=e[d],{ray:p}=o;let y,u;if(o.point===null)C.start.copy(p.origin),p.at(1,C.end),he(q,C,O),o.distance=O.x*(1-Math.abs(w.dot(p.direction))),o.inFrustum=!0;else{const m=C.start;m.copy(o.point).applyMatrix4(A),m.x>-1&&m.x<1&&m.y>-1&&m.y<1&&m.z>-1&&m.z<1?(o.distance=m.subVectors(o.point,q.start).dot(w),o.inFrustum=!0):(o.distance=0,o.inFrustum=!1)}l===0?(o.distance=y,o.inFrustum=u):(o.inFrustum=o.inFrustum||u,o.distance=Math.min(o.distance,y))}}),t.length!==0&&e.sort((r,l)=>r.point===null!=(l.point===null)?r.point===null?1:-1:r.inFrustum!==l.inFrustum?r.inFrustum?1:-1:r.distance<0!=l.distance<0?r.distance<0?-1:1:l.distance-r.distance);e.length!==0&&performance.now()-s<n;){const r=e.pop();r.queued=!1,this._updateQuery(r)}e.length!==0&&this._scheduleRun()}_scheduleRun(){this.autoRun&&!this.scheduled&&(this.scheduled=!0,requestAnimationFrame(()=>{this.scheduled=!1,this._runJobs()}))}_updateQuery(e){R.ray.copy(e.ray),R.far="lat"in e?1e4+Math.max(...this.ellipsoid.radius):1/0;const t=R.intersectObjects(this.objects)[0]||null;t!==null&&(e.point===null?e.point=t.point.clone():e.point.copy(t.point)),e.callback(t)}addCamera(e){const{queryMap:t,cameras:n}=this;n.add(e),t.forEach(s=>this._enqueue(s))}deleteCamera(e){const{cameras:t}=this;t.delete(e)}runIfNeeded(e){const{queryMap:t,queued:n}=this,s=t.get(e);s.queued&&(this._updateQuery(s),s.queued=!1,n.splice(n.indexOf(s),1))}setScene(...e){const{observer:t}=this;t.dispose(),e.forEach(n=>t.observe(n)),this.objects=e,this._scheduleRun()}setEllipsoidFromTilesRenderer(e){const{queryMap:t,ellipsoid:n,frame:s}=this;(!n.radius.equals(e.ellipsoid.radius)||!s.equals(e.group.matrixWorld))&&(n.copy(e.ellipsoid),s.copy(e.group.matrixWorld),t.forEach(r=>{if("lat"in r){const{lat:l,lon:d,ray:i}=r;n.getCartographicToPosition(l,d,1e4,i.origin).applyMatrix4(s),n.getCartographicToNormal(l,d,i.direction).transformDirection(s).multiplyScalar(-1)}this._enqueue(r)}))}registerRayQuery(e,t){const n=this.index++,s={ray:e.clone(),callback:t,queued:!1,distance:-1,point:null};return this.queryMap.set(n,s),this._enqueue(s),n}registerLatLonQuery(e,t,n){const{ellipsoid:s,frame:r}=this,l=this.index++,d=new V;s.getCartographicToPosition(e,t,1e4,d.origin).applyMatrix4(r),s.getCartographicToNormal(e,t,d.direction).transformDirection(r).multiplyScalar(-1);const i={ray:d.clone(),lat:e,lon:t,callback:n,queued:!1,distance:-1,point:null};return this.queryMap.set(l,i),this._enqueue(i),l}unregisterQuery(e){const{queued:t,queryMap:n}=this,s=n.get(e);n.delete(e),s&&s.queued&&(s.queued=!1,t.splice(t.indexOf(s),1))}dispose(){this.queryMap.clear(),this.queued.length=0,this.objects.length=0,this.observer.dispose()}}const he=function(){const h=new g,e=new g,t=new g;return function(s,r,l){const d=s.start,i=h,o=r.start,p=e;t.subVectors(d,o),h.subVectors(s.end,s.start),e.subVectors(r.end,r.start);const y=t.dot(p),u=p.dot(i),m=p.dot(p),x=t.dot(i),f=i.dot(i)*m-u*u;let b,M;f!==0?b=(y*u-x*m)/f:b=0,M=(y+b*u)/m,l.x=b,l.y=M}}(),L=c.createContext(null),_=new P,T=new V,fe=c.forwardRef(function(e,t){const{interpolationFactor:n=.025,onQueryUpdate:s=null,...r}=e,l=c.useContext(S),d=c.useContext(L),i=E(({invalidate:x})=>x),o=c.useMemo(()=>new g,[]),p=c.useMemo(()=>({value:!1}),[]),y=c.useMemo(()=>({value:!1}),[]),u=c.useRef(null),m=c.useCallback(x=>{if(l===null||x===null||u.current===null)return;const{lat:v,lon:f,rayorigin:b,raydirection:M}=r;v!==null&&f!==null?(o.copy(x.point),y.value=!0,d.ellipsoid.getObjectFrame(v,f,0,0,0,0,_,G).premultiply(l.group.matrixWorld),u.current.quaternion.setFromRotationMatrix(_),i()):b!==null&&M!==null&&(o.copy(x.point),y.value=!0,u.current.quaternion.identity(),i()),s&&s(x)},[i,y,d.ellipsoid,r,o,l,s]);return k((x,v)=>{if(u.current&&(u.current.visible=p.value),u.current&&y.value)if(p.value===!1)p.value=!0,u.current.position.copy(o);else{const f=1-2**(-v/n);u.current.position.distanceToSquared(o)>1e-6?(u.current.position.lerp(o,n===0?1:f),i()):u.current.position.copy(o)}}),a.jsx(ye,{ref:U(u,t),onQueryUpdate:m,...r})}),ye=c.forwardRef(function(e,t){const{component:n=a.jsx("group",{}),lat:s=null,lon:r=null,rayorigin:l=null,raydirection:d=null,onQueryUpdate:i=null,...o}=e,p=c.useRef(null),y=c.useContext(S),u=c.useContext(L),m=E(({invalidate:v})=>v),x=c.useMemo(()=>new g,[]);return c.useEffect(()=>{const v=f=>{i?i(f):y&&f!==null&&p.current!==null&&(s!==null&&r!==null?(p.current.position.copy(f.point),u.ellipsoid.getObjectFrame(s,r,0,0,0,0,_,G).premultiply(y.group.matrixWorld),p.current.quaternion.setFromRotationMatrix(_),m()):l!==null&&d!==null&&(p.current.position.copy(f.point),p.current.quaternion.identity(),m()))};if(s!==null&&r!==null){const f=u.registerLatLonQuery(s,r,v);return()=>u.unregisterQuery(f)}else if(l!==null&&d!==null){T.origin.copy(l),T.direction.copy(d);const f=u.registerRayQuery(T,v);return()=>u.unregisterQuery(f)}},[s,r,l,d,u,y,m,x,i]),c.cloneElement(n,{...o,ref:U(p,t),raycast:()=>!1})}),xe=c.forwardRef(function(e,t){const n=E(({scene:p})=>p),{scene:s=n,children:r,...l}=e,d=c.useContext(S),i=c.useMemo(()=>new me,[]),o=E(({camera:p})=>p);return N(i,l),c.useEffect(()=>()=>i.dispose(),[i]),c.useEffect(()=>{i.setScene(...Array.isArray(s)?s:[s])},[i,s]),c.useEffect(()=>{i.addCamera(o)},[i,o]),k(()=>{d&&i.setEllipsoidFromTilesRenderer(d)}),H(i,t),a.jsx(L.Provider,{value:i,children:a.jsx("group",{matrixAutoUpdate:!1,matrixWorldAutoUpdate:!1,children:r})})}),ve=new Z().setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),Q=new g,I=new g;function ge(h){const e=c.useRef();return k(({camera:t})=>{const n=e.current;let s;t.isPerspectiveCamera?(Q.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(n.matrixWorld),s=.05*Q.distanceTo(I)*Math.atan(t.fov*J.DEG2RAD)):s=(t.top-t.bottom)*.05/t.zoom,s=Math.min(Math.max(s,100),2e5),n.scale.setScalar(s*.5)}),a.jsxs(fe,{ref:e,...h,children:[a.jsxs("mesh",{"position-y":1.25,scale:.5,children:[a.jsx("sphereGeometry",{}),a.jsx("meshStandardMaterial",{color:16007990,emissive:16007990,emissiveIntensity:.25})]}),a.jsxs("mesh",{"position-y":.5,scale:[.1,1,.1],children:[a.jsx("cylinderGeometry",{}),a.jsx("meshStandardMaterial",{color:16007990,emissive:16007990,emissiveIntensity:.25})]})]})}function be(){const h={ortho:!1},e=new Array(500).fill().map((n,s)=>{const r=-Math.PI/2+Math.PI*s/500,l=s;return a.jsx(ge,{lat:r,lon:l,scale:.1},s)}),{ortho:t}=ee(h);return a.jsxs(K,{frameloop:"demand",camera:{position:[0,.5*1e7,1.5*1e7]},style:{width:"100%",height:"100%",position:"absolute",margin:0,left:0,top:0},flat:!0,children:[a.jsx("color",{attach:"background",args:[1118481]}),a.jsxs(X,{group:{rotation:[-Math.PI/2,0,0]},children:[a.jsx(j,{plugin:ae,args:{apiToken:"",assetId:"2275207",autoRefreshToken:!0}}),a.jsx(j,{plugin:le,dracoLoader:ve}),a.jsx(j,{plugin:ue}),a.jsx(j,{plugin:ce}),a.jsx(j,{plugin:de}),a.jsx(Y,{enableDamping:!0}),a.jsx(ne,{mode:t?"orthographic":"perspective"}),a.jsx(te,{}),a.jsx(se,{}),a.jsx(re,{}),a.jsx(xe,{children:e})]}),a.jsx(oe,{preset:"sunset",backgroundBlurriness:.9,environmentIntensity:1})]})}$.createRoot(document.getElementById("root")).render(a.jsx(c.StrictMode,{children:a.jsx(be,{})}));
//# sourceMappingURL=settling-DIEJznkR.js.map
