import{_ as w}from"./extends-CF3RwP-h.js";import{u as y,r as e,a as F,g as Q}from"./CameraControls-BTa4S6yL.js";import{aD as Y,Y as X,w as A,az as Z,Z as B,S as V,l as P,au as J,Q as H,k as K,b2 as N}from"./three.module-CQU0seT4.js";function U(n,d,l){const o=y(u=>u.size),s=y(u=>u.viewport),m=typeof n=="number"?n:o.width*s.dpr,i=o.height*s.dpr,r=(typeof n=="number"?l:n)||{},{samples:c=0,depth:g,...f}=r,p=e.useMemo(()=>{const u=new Y(m,i,{minFilter:A,magFilter:A,type:X,...f});return g&&(u.depthTexture=new Z(m,i,B)),u.samples=c,u},[]);return e.useLayoutEffect(()=>{p.setSize(m,i),c&&(p.samples=c)},[c,p,m,i]),e.useEffect(()=>()=>p.dispose(),[]),p}const $=n=>typeof n=="function",ee=e.forwardRef(({envMap:n,resolution:d=256,frames:l=1/0,children:o,makeDefault:s,...m},i)=>{const r=y(({set:t})=>t),c=y(({camera:t})=>t),g=y(({size:t})=>t),f=e.useRef(null);e.useImperativeHandle(i,()=>f.current,[]);const p=e.useRef(null),u=U(d);e.useLayoutEffect(()=>{m.manual||f.current.updateProjectionMatrix()},[g,m]),e.useLayoutEffect(()=>{f.current.updateProjectionMatrix()}),e.useLayoutEffect(()=>{if(s){const t=c;return r(()=>({camera:f.current})),()=>r(()=>({camera:t}))}},[f,s,r]);let h=0,E=null;const a=$(o);return F(t=>{a&&(l===1/0||h<l)&&(p.current.visible=!1,t.gl.setRenderTarget(u),E=t.scene.background,n&&(t.scene.background=n),t.gl.render(t.scene,f.current),t.scene.background=E,t.gl.setRenderTarget(null),p.current.visible=!0,h++)}),e.createElement(e.Fragment,null,e.createElement("orthographicCamera",w({left:g.width/-2,right:g.width/2,top:g.height/2,bottom:g.height/-2,ref:f},m),!a&&o),e.createElement("group",{ref:p},a&&o(u.texture)))});function te({defaultScene:n,defaultCamera:d,renderPriority:l=1}){const{gl:o,scene:s,camera:m}=y();let i;return F(()=>{i=o.autoClear,l===1&&(o.autoClear=!0,o.render(n,d)),o.autoClear=!1,o.clearDepth(),o.render(s,m),o.autoClear=i},l),e.createElement("group",{onPointerOver:()=>null})}function ne({children:n,renderPriority:d=1}){const{scene:l,camera:o}=y(),[s]=e.useState(()=>new V);return e.createElement(e.Fragment,null,Q(e.createElement(e.Fragment,null,n,e.createElement(te,{defaultScene:l,defaultCamera:o,renderPriority:d})),s,{events:{priority:d+1}}))}const G=e.createContext({}),re=()=>e.useContext(G),oe=2*Math.PI,R=new J,I=new K,[C,M]=[new H,new H],L=new P,k=new P,ae=n=>"minPolarAngle"in n,q=n=>"getTarget"in n,ue=({alignment:n="bottom-right",margin:d=[80,80],renderPriority:l=1,onUpdate:o,onTarget:s,children:m})=>{const i=y(x=>x.size),r=y(x=>x.camera),c=y(x=>x.controls),g=y(x=>x.invalidate),f=e.useRef(null),p=e.useRef(null),u=e.useRef(!1),h=e.useRef(0),E=e.useRef(new P(0,0,0)),a=e.useRef(new P(0,0,0));e.useEffect(()=>{a.current.copy(r.up),R.up.copy(r.up)},[r]);const t=e.useCallback(x=>{u.current=!0,(c||s)&&(E.current=(s==null?void 0:s())||(q(c)?c.getTarget(E.current):c==null?void 0:c.target)),h.current=r.position.distanceTo(L),C.copy(r.quaternion),k.copy(x).multiplyScalar(h.current).add(L),R.lookAt(k),M.copy(R.quaternion),g()},[c,r,s,g]);F((x,T)=>{if(p.current&&f.current){var O;if(u.current)if(C.angleTo(M)<.01)u.current=!1,ae(c)&&r.up.copy(a.current);else{const j=T*oe;C.rotateTowards(M,j),r.position.set(0,0,1).applyQuaternion(C).multiplyScalar(h.current).add(E.current),r.up.set(0,1,0).applyQuaternion(C).normalize(),r.quaternion.copy(C),q(c)&&c.setPosition(r.position.x,r.position.y,r.position.z),o?o():c&&c.update(T),g()}I.copy(r.matrix).invert(),(O=f.current)==null||O.quaternion.setFromRotationMatrix(I)}});const D=e.useMemo(()=>({tweenCamera:t}),[t]),[b,z]=d,W=n.endsWith("-center")?0:n.endsWith("-left")?-i.width/2+b:i.width/2-b,_=n.startsWith("center-")?0:n.startsWith("top-")?i.height/2-z:-i.height/2+z;return e.createElement(ne,{renderPriority:l},e.createElement(G.Provider,{value:D},e.createElement(ee,{makeDefault:!0,ref:p,position:[0,0,200]}),e.createElement("group",{ref:f,position:[W,_,0]},m)))};function S({scale:n=[.8,.05,.05],color:d,rotation:l}){return e.createElement("group",{rotation:l},e.createElement("mesh",{position:[.4,0,0]},e.createElement("boxGeometry",{args:n}),e.createElement("meshBasicMaterial",{color:d,toneMapped:!1})))}function v({onClick:n,font:d,disabled:l,arcStyle:o,label:s,labelColor:m,axisHeadScale:i=1,...r}){const c=y(a=>a.gl),g=e.useMemo(()=>{const a=document.createElement("canvas");a.width=64,a.height=64;const t=a.getContext("2d");return t.beginPath(),t.arc(32,32,16,0,2*Math.PI),t.closePath(),t.fillStyle=o,t.fill(),s&&(t.font=d,t.textAlign="center",t.fillStyle=m,t.fillText(s,32,41)),new N(a)},[o,s,m,d]),[f,p]=e.useState(!1),u=(s?1:.75)*(f?1.2:1)*i,h=a=>{a.stopPropagation(),p(!0)},E=a=>{a.stopPropagation(),p(!1)};return e.createElement("sprite",w({scale:u,onPointerOver:l?void 0:h,onPointerOut:l?void 0:n||E},r),e.createElement("spriteMaterial",{map:g,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}const le=({hideNegativeAxes:n,hideAxisHeads:d,disabled:l,font:o="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:m=1,axisScale:i,labels:r=["X","Y","Z"],labelColor:c="#000",onClick:g,...f})=>{const[p,u,h]=s,{tweenCamera:E}=re(),a={font:o,disabled:l,labelColor:c,onClick:g,axisHeadScale:m,onPointerDown:l?void 0:t=>{E(t.object.position),t.stopPropagation()}};return e.createElement("group",w({scale:40},f),e.createElement(S,{color:p,rotation:[0,0,0],scale:i}),e.createElement(S,{color:u,rotation:[0,0,Math.PI/2],scale:i}),e.createElement(S,{color:h,rotation:[0,-Math.PI/2,0],scale:i}),!d&&e.createElement(e.Fragment,null,e.createElement(v,w({arcStyle:p,position:[1,0,0],label:r[0]},a)),e.createElement(v,w({arcStyle:u,position:[0,1,0],label:r[1]},a)),e.createElement(v,w({arcStyle:h,position:[0,0,1],label:r[2]},a)),!n&&e.createElement(e.Fragment,null,e.createElement(v,w({arcStyle:p,position:[-1,0,0]},a)),e.createElement(v,w({arcStyle:u,position:[0,-1,0]},a)),e.createElement(v,w({arcStyle:h,position:[0,0,-1]},a)))))};export{ue as G,le as a,U as u};
//# sourceMappingURL=GizmoViewport-DtionKFo.js.map
