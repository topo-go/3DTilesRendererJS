{"version":3,"file":"ionExample-BpbCX-OH.js","sources":["../../ionExample.js"],"sourcesContent":["import { EnvironmentControls, TilesRenderer } from '3d-tiles-renderer';\nimport { CesiumIonAuthPlugin, GLTFExtensionsPlugin } from '3d-tiles-renderer/plugins';\nimport {\n\tScene,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n\tVector3,\n\tQuaternion,\n\tSphere,\n\tDataTexture,\n\tEquirectangularReflectionMapping\n} from 'three';\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nlet camera, controls, scene, renderer, tiles;\n\nconst apiKey = localStorage.getItem( 'ionApiKey' ) ?? 'put-your-api-key-here';\n\nconst params = {\n\tionAssetId: '40866',\n\t// ionAssetId: '2333904',\n\t// ionAssetId: '2342602',\n\tionAccessToken: apiKey,\n\treload: reinstantiateTiles,\n};\n\ninit();\nanimate();\n\nfunction rotationBetweenDirections( dir1, dir2 ) {\n\n\tconst rotation = new Quaternion();\n\tconst a = new Vector3().crossVectors( dir1, dir2 );\n\trotation.x = a.x;\n\trotation.y = a.y;\n\trotation.z = a.z;\n\trotation.w = 1 + dir1.clone().dot( dir2 );\n\trotation.normalize();\n\n\treturn rotation;\n\n}\n\nfunction setupTiles() {\n\n\ttiles.fetchOptions.mode = 'cors';\n\ttiles.registerPlugin( new GLTFExtensionsPlugin( {\n\t\t// Note the DRACO compression files need to be supplied via an explicit source.\n\t\t// We use unpkg here but in practice should be provided by the application.\n\t\tdracoLoader: new DRACOLoader().setDecoderPath( 'https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/' )\n\t} ) );\n\n\tscene.add( tiles.group );\n\n}\n\nfunction reinstantiateTiles() {\n\n\tif ( tiles ) {\n\n\t\tscene.remove( tiles.group );\n\t\ttiles.dispose();\n\t\ttiles = null;\n\n\t}\n\n\tlocalStorage.setItem( 'ionApiKey', params.ionAccessToken );\n\n\ttiles = new TilesRenderer();\n\ttiles.registerPlugin( new CesiumIonAuthPlugin( { apiToken: params.ionAccessToken, assetId: params.ionAssetId } ) );\n\ttiles.addEventListener( 'load-tile-set', () => {\n\n\t\t// because ion examples typically are positioned on the planet surface we can orient\n\t\t// it such that up is Y+ and center the model\n\t\tconst sphere = new Sphere();\n\t\ttiles.getBoundingSphere( sphere );\n\n\t\tconst position = sphere.center.clone();\n\t\tconst distanceToEllipsoidCenter = position.length();\n\n\t\tconst surfaceDirection = position.normalize();\n\t\tconst up = new Vector3( 0, 1, 0 );\n\t\tconst rotationToNorthPole = rotationBetweenDirections( surfaceDirection, up );\n\n\t\ttiles.group.quaternion.x = rotationToNorthPole.x;\n\t\ttiles.group.quaternion.y = rotationToNorthPole.y;\n\t\ttiles.group.quaternion.z = rotationToNorthPole.z;\n\t\ttiles.group.quaternion.w = rotationToNorthPole.w;\n\n\t\ttiles.group.position.y = - distanceToEllipsoidCenter;\n\n\t} );\n\n\tsetupTiles();\n\n}\n\nfunction init() {\n\n\tscene = new Scene();\n\n\t// Add an env map for MeshStandardMaterial so lighting and metalness are rendered\n\tconst env = new DataTexture( new Uint8Array( 64 * 64 * 4 ).fill( 255 ), 64, 64 );\n\tenv.mapping = EquirectangularReflectionMapping;\n\tenv.needsUpdate = true;\n\tscene.environment = env;\n\n\t// primary camera view\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setClearColor( 0x151c1f );\n\n\tdocument.body.appendChild( renderer.domElement );\n\trenderer.domElement.tabIndex = 1;\n\n\tcamera = new PerspectiveCamera(\n\t\t60,\n\t\twindow.innerWidth / window.innerHeight,\n\t\t1,\n\t\t100000\n\t);\n\tcamera.position.set( 100, 100, - 100 );\n\tcamera.lookAt( 0, 0, 0 );\n\n\t// controls\n\tcontrols = new EnvironmentControls( scene, camera, renderer.domElement );\n\tcontrols.adjustHeight = false;\n\tcontrols.minDistance = 1;\n\tcontrols.maxAltitude = Math.PI;\n\n\treinstantiateTiles();\n\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\n\t// GUI\n\tconst gui = new GUI();\n\tgui.width = 300;\n\n\tconst ionOptions = gui.addFolder( 'Ion' );\n\tionOptions.add( params, 'ionAssetId' );\n\tionOptions.add( params, 'ionAccessToken' );\n\tionOptions.add( params, 'reload' );\n\tionOptions.open();\n\n}\n\nfunction onWindowResize() {\n\n\tcamera.aspect = window.innerWidth / window.innerHeight;\n\tcamera.updateProjectionMatrix();\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tif ( ! tiles ) return;\n\n\tcontrols.update();\n\n\ttiles.setCamera( camera );\n\ttiles.setResolutionFromRenderer( camera, renderer );\n\n\t// update tiles\n\tcamera.updateMatrixWorld();\n\ttiles.update();\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["camera","controls","scene","renderer","tiles","apiKey","params","reinstantiateTiles","init","animate","rotationBetweenDirections","dir1","dir2","rotation","Quaternion","a","Vector3","setupTiles","GLTFExtensionsPlugin","DRACOLoader","TilesRenderer","CesiumIonAuthPlugin","sphere","Sphere","position","distanceToEllipsoidCenter","surfaceDirection","up","rotationToNorthPole","Scene","env","DataTexture","EquirectangularReflectionMapping","WebGLRenderer","PerspectiveCamera","EnvironmentControls","onWindowResize","gui","GUI","ionOptions"],"mappings":"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"}