import{u as b,r as o,d as W,a as w,g as D,j as a,k as O,i as _}from"./CameraControls-BTa4S6yL.js";import{S as k,O as F,l as T,k as A,ae as B,aM as G}from"./three.module-CQU0seT4.js";import{c as q}from"./EnvironmentControls-CLbQ_1-I.js";import{C as I}from"./CameraTransitionManager-BIWFAn1E.js";import{C as V}from"./CanvasDOMOverlay-DhqylH3l.js";const h=new T,j=new T,M=new T,R=new A,L=new A,P=new B,z={};function X(i,l,s,r){P.origin.copy(i.position),P.direction.set(0,0,-1).transformDirection(i.matrixWorld),P.applyMatrix4(s.matrixWorldInverse),q(P,l,M),M.applyMatrix4(s.matrixWorld),j.set(0,0,-1).transformDirection(i.matrixWorld);const m=M.sub(i.position).dot(j);return r.copy(i.position).addScaledVector(j,m),r}function Y(i){const{defaultScene:l,defaultCamera:s,overrideRenderLoop:r=!0,renderPriority:m=1}=i,n=o.useMemo(()=>new F,[]),[g,f,u,y]=b(c=>[c.set,c.size,c.gl,c.scene]);o.useEffect(()=>{g({camera:n})},[g,n]),o.useEffect(()=>{n.left=-f.width/2,n.right=f.width/2,n.top=f.height/2,n.bottom=-f.height/2,n.near=0,n.far=2e3,n.position.z=n.far/2,n.updateProjectionMatrix()},[n,f]),w(()=>{r&&u.render(l,s);const c=u.autoClear;u.autoClear=!1,u.clearDepth(),u.render(y,n),u.autoClear=c},m)}function S(){const i=o.useRef();return o.useEffect(()=>{const s=i.current.attributes.position;for(let r=0,m=s.count;r<m;r++)h.fromBufferAttribute(s,r),h.y>0&&(h.x=0,s.setXYZ(r,...h))}),a.jsx("boxGeometry",{ref:i})}function N({northColor:i=15684432,southColor:l=16777215}){const[s,r]=o.useState(),m=o.useRef();return o.useEffect(()=>{r(m.current)},[]),a.jsxs("group",{scale:.5,ref:m,children:[a.jsx("ambientLight",{intensity:1}),a.jsx("directionalLight",{position:[0,2,3],intensity:3,target:s}),a.jsx("directionalLight",{position:[0,-2,-3],intensity:3,target:s}),a.jsxs("mesh",{children:[a.jsx("sphereGeometry",{}),a.jsx("meshBasicMaterial",{color:0,opacity:.3,transparent:!0,side:G})]}),a.jsxs("group",{scale:[.5,1,.15],children:[a.jsxs("mesh",{"position-y":.5,children:[a.jsx(S,{}),a.jsx("meshStandardMaterial",{color:i})]}),a.jsxs("mesh",{"position-y":-.5,"rotation-x":Math.PI,children:[a.jsx(S,{}),a.jsx("meshStandardMaterial",{color:l})]})]})]})}function K({children:i,overrideRenderLoop:l,mode:s="3d",margin:r=10,scale:m=35,visible:n=!0,...g}){const[f,u,y]=b(t=>[t.camera,t.scene,t.size]),c=o.useContext(W),d=o.useRef(null),E=o.useMemo(()=>new k,[]);let C,e;return Array.isArray(r)?(C=r[0],e=r[1]):(C=r,e=r),w(()=>{if(c===null||d.current===null)return null;const{ellipsoid:t}=c,p=d.current;if(X(f,t,c.group,M).applyMatrix4(c.group.matrixWorldInverse),t.getPositionToCartographic(M,z),t.getEastNorthUpFrame(z.lat,z.lon,0,L).premultiply(c.group.matrixWorld),L.invert(),R.copy(f.matrixWorld).premultiply(L),s.toLowerCase()==="3d")p.quaternion.setFromRotationMatrix(R).invert();else if(h.set(0,1,0).transformDirection(R).normalize(),h.z=0,h.normalize(),h.length()===0)p.quaternion.identity();else{const x=j.set(0,1,0).angleTo(h);j.cross(h).normalize(),p.quaternion.setFromAxisAngle(j,-x)}}),i||(i=a.jsx(N,{})),n?D(a.jsxs(a.Fragment,{children:[a.jsx("group",{ref:d,scale:m,position:[y.width/2-C-m/2,-y.height/2+e+m/2,0],...g,children:i}),a.jsx(Y,{defaultCamera:f,defaultScene:u,overrideRenderLoop:l,renderPriority:10})]}),E,{events:{priority:10}}):null}const Q=o.forwardRef(function(l,s){const{mode:r="perspective",onBeforeToggle:m,perspectiveCamera:n,orthographicCamera:g,...f}=l,[u,y,c,d,E,C]=b(t=>[t.set,t.get,t.invalidate,t.controls,t.camera,t.size]),e=o.useMemo(()=>{const t=new I;return t.autoSync=!1,E.isOrthographicCamera?(t.orthographicCamera.copy(E),t.mode="orthographic"):t.perspectiveCamera.copy(E),t.syncCameras(),t.mode=r,t},[]);o.useEffect(()=>{const{perspectiveCamera:t,orthographicCamera:p}=e,x=C.width/C.height;t.aspect=x,t.updateProjectionMatrix(),p.left=-p.top*x,p.right=-p.left,t.updateProjectionMatrix()},[e,C]),O(e,s),o.useEffect(()=>{const t=({camera:p})=>{u(()=>({camera:p}))};return u(()=>({camera:e.camera})),e.addEventListener("camera-change",t),()=>{e.removeEventListener("camera-change",t)}},[e,u]),o.useEffect(()=>{const t=e.perspectiveCamera,p=e.orthographicCamera;return e.perspectiveCamera=n||t,e.orthographicCamera=g||p,u(()=>({camera:e.camera})),()=>{e.perspectiveCamera=t,e.orthographicCamera=p}},[n,g,e,u]),o.useEffect(()=>{if(r!==e.mode){const t=r==="orthographic"?e.orthographicCamera:e.perspectiveCamera;m?m(e,t):d&&d.isEnvironmentControls?(d.getPivotPoint(e.fixedPoint),e.syncCameras(),d.adjustCamera(e.perspectiveCamera),d.adjustCamera(e.orthographicCamera)):(e.fixedPoint.set(0,0,-1).transformDirection(e.camera.matrixWorld).multiplyScalar(50).add(e.camera.position),e.syncCameras()),e.toggle(),c()}},[r,e,c,d,m]),o.useEffect(()=>{const t=()=>c();return e.addEventListener("transition-start",t),e.addEventListener("change",t),e.addEventListener("transition-end",t),()=>{e.removeEventListener("transition-start",t),e.removeEventListener("change",t),e.removeEventListener("transition-end",t)}},[e,c]),_(e,f),w(()=>{e.update(),d&&(d.enabled=!e.animating);const{camera:t,size:p}=y();if(!g&&t===e.orthographicCamera){const x=p.width/p.height,v=e.orthographicCamera;x!==v.right&&(v.bottom=-1,v.top=1,v.left=-x,v.right=x,v.updateProjectionMatrix())}e.animating&&c()},-1)});function ee(i){const l=o.useContext(W),s=o.useRef();return w(()=>{const r=s.current;r&&l&&(r.style.width=`${l.loadProgress*100}%`,r.style.opacity=l.loadProgress===1?0:1,r.style.transition=l.loadProgress===1?"opacity 0.5s linear":"")}),a.jsx(V,{ref:s,style:{position:"absolute",left:0,bottom:0,height:"2px",background:"white",opacity:0,width:"100%"}})}export{K as C,ee as T,Q as a};
//# sourceMappingURL=TilesLoadingBar-DWCtesE7.js.map
