{"version":3,"file":"i3dmExample-D0pG0_cC.js","sources":["../../i3dmExample.js"],"sourcesContent":["import { I3DMLoader } from '3d-tiles-renderer';\nimport {\n\tScene,\n\tDirectionalLight,\n\tAmbientLight,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n\tPCFSoftShadowMap,\n\tVector3,\n\tQuaternion,\n\tMatrix4,\n} from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\n\nlet camera, controls, scene, renderer;\nlet dirLight;\n\ninit();\nanimate();\n\nfunction init() {\n\n\tscene = new Scene();\n\n\t// primary camera view\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( 0x151c1f );\n\trenderer.shadowMap.enabled = true;\n\trenderer.shadowMap.type = PCFSoftShadowMap;\n\n\tdocument.body.appendChild( renderer.domElement );\n\n\tcamera = new PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 4000 );\n\tcamera.position.set( 100, 100, 100 );\n\n\t// controls\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\tcontrols.screenSpacePanning = false;\n\tcontrols.minDistance = 1;\n\tcontrols.maxDistance = 2000;\n\n\t// lights\n\tdirLight = new DirectionalLight( 0xffffff, 1.25 );\n\tdirLight.position.set( 1, 2, 3 ).multiplyScalar( 40 );\n\tdirLight.castShadow = true;\n\tdirLight.shadow.bias = - 0.01;\n\tdirLight.shadow.mapSize.setScalar( 2048 );\n\n\tconst shadowCam = dirLight.shadow.camera;\n\tshadowCam.left = - 200;\n\tshadowCam.bottom = - 200;\n\tshadowCam.right = 200;\n\tshadowCam.top = 200;\n\tshadowCam.updateProjectionMatrix();\n\n\tscene.add( dirLight );\n\n\tconst ambLight = new AmbientLight( 0xffffff, 0.05 );\n\tscene.add( ambLight );\n\n\tnew I3DMLoader()\n\t\t.loadAsync( 'https://raw.githubusercontent.com/CesiumGS/3d-tiles-samples/main/1.0/TilesetWithTreeBillboards/tree.i3dm' )\n\t\t.then( res => {\n\n\t\t\tlet instance = null;\n\t\t\tres.scene.traverse( c => {\n\n\t\t\t\tif ( ! instance && c.isInstancedMesh ) {\n\n\t\t\t\t\tinstance = c;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tif ( instance ) {\n\n\t\t\t\tres.scene.updateMatrixWorld( true );\n\n\t\t\t\tconst pos = new Vector3();\n\t\t\t\tconst quat = new Quaternion();\n\t\t\t\tconst sca = new Vector3();\n\t\t\t\tconst mat = new Matrix4();\n\t\t\t\tconst averagePos = new Vector3();\n\n\t\t\t\tfor ( let i = 0, l = instance.count; i < l; i ++ ) {\n\n\t\t\t\t\tinstance.getMatrixAt( i, mat );\n\t\t\t\t\tmat.premultiply( instance.matrixWorld );\n\t\t\t\t\tmat.decompose( pos, quat, sca );\n\t\t\t\t\taveragePos.add( pos );\n\n\t\t\t\t}\n\n\t\t\t\taveragePos.divideScalar( instance.count );\n\t\t\t\tcontrols.target.copy( averagePos );\n\t\t\t\tcamera.position.add( averagePos );\n\t\t\t\tcontrols.update();\n\n\t\t\t}\n\n\t\t\tconsole.log( res );\n\t\t\tscene.add( res.scene );\n\n\t\t} );\n\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\n}\n\nfunction onWindowResize() {\n\n\tcamera.aspect = window.innerWidth / window.innerHeight;\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\tcamera.updateProjectionMatrix();\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\trender();\n\n}\n\nfunction render() {\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["camera","controls","scene","renderer","dirLight","init","animate","Scene","WebGLRenderer","PCFSoftShadowMap","PerspectiveCamera","OrbitControls","DirectionalLight","shadowCam","ambLight","AmbientLight","I3DMLoader","res","instance","c","pos","Vector3","quat","Quaternion","sca","mat","Matrix4","averagePos","i","l","onWindowResize","render"],"mappings":"kUAcA,IAAIA,EAAQC,EAAUC,EAAOC,EACzBC,EAEJC,EAAM,EACNC,EAAS,EAET,SAASD,GAAO,CAEfH,EAAQ,IAAIK,EAGZJ,EAAW,IAAIK,EAAe,CAAE,UAAW,EAAI,CAAI,EACnDL,EAAS,cAAe,OAAO,gBAAkB,EACjDA,EAAS,QAAS,OAAO,WAAY,OAAO,WAAa,EACzDA,EAAS,cAAe,OAAU,EAClCA,EAAS,UAAU,QAAU,GAC7BA,EAAS,UAAU,KAAOM,EAE1B,SAAS,KAAK,YAAaN,EAAS,UAAY,EAEhDH,EAAS,IAAIU,EAAmB,GAAI,OAAO,WAAa,OAAO,YAAa,EAAG,GAAM,EACrFV,EAAO,SAAS,IAAK,IAAK,IAAK,GAAK,EAGpCC,EAAW,IAAIU,EAAeX,EAAQG,EAAS,UAAY,EAC3DF,EAAS,mBAAqB,GAC9BA,EAAS,YAAc,EACvBA,EAAS,YAAc,IAGvBG,EAAW,IAAIQ,EAAkB,SAAU,IAAM,EACjDR,EAAS,SAAS,IAAK,EAAG,EAAG,CAAG,EAAC,eAAgB,EAAI,EACrDA,EAAS,WAAa,GACtBA,EAAS,OAAO,KAAO,KACvBA,EAAS,OAAO,QAAQ,UAAW,IAAM,EAEzC,MAAMS,EAAYT,EAAS,OAAO,OAClCS,EAAU,KAAO,KACjBA,EAAU,OAAS,KACnBA,EAAU,MAAQ,IAClBA,EAAU,IAAM,IAChBA,EAAU,uBAAwB,EAElCX,EAAM,IAAKE,CAAU,EAErB,MAAMU,EAAW,IAAIC,EAAc,SAAU,GAAM,EACnDb,EAAM,IAAKY,CAAU,EAErB,IAAIE,EAAU,EACZ,UAAW,0GAA0G,EACrH,KAAMC,GAAO,CAEb,IAAIC,EAAW,KAWf,GAVAD,EAAI,MAAM,SAAUE,GAAK,CAEnB,CAAED,GAAYC,EAAE,kBAEpBD,EAAWC,EAIhB,CAAM,EAEED,EAAW,CAEfD,EAAI,MAAM,kBAAmB,EAAM,EAEnC,MAAMG,EAAM,IAAIC,EACVC,EAAO,IAAIC,EACXC,EAAM,IAAIH,EACVI,EAAM,IAAIC,EACVC,EAAa,IAAIN,EAEvB,QAAUO,EAAI,EAAGC,EAAIX,EAAS,MAAOU,EAAIC,EAAGD,IAE3CV,EAAS,YAAaU,EAAGH,CAAK,EAC9BA,EAAI,YAAaP,EAAS,WAAa,EACvCO,EAAI,UAAWL,EAAKE,EAAME,CAAK,EAC/BG,EAAW,IAAKP,CAAK,EAItBO,EAAW,aAAcT,EAAS,KAAO,EACzCjB,EAAS,OAAO,KAAM0B,CAAY,EAClC3B,EAAO,SAAS,IAAK2B,CAAY,EACjC1B,EAAS,OAAQ,CAErB,CAEG,QAAQ,IAAKgB,CAAK,EAClBf,EAAM,IAAKe,EAAI,KAAO,CAEzB,CAAK,EAEJa,EAAgB,EAChB,OAAO,iBAAkB,SAAUA,EAAgB,EAAO,CAE3D,CAEA,SAASA,GAAiB,CAEzB9B,EAAO,OAAS,OAAO,WAAa,OAAO,YAC3CG,EAAS,cAAe,OAAO,gBAAkB,EACjDA,EAAS,QAAS,OAAO,WAAY,OAAO,WAAa,EACzDH,EAAO,uBAAwB,CAEhC,CAEA,SAASM,GAAU,CAElB,sBAAuBA,CAAS,EAEhCyB,EAAQ,CAET,CAEA,SAASA,GAAS,CAEjB5B,EAAS,OAAQD,EAAOF,CAAQ,CAEjC"}